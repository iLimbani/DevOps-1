pipeline {
   	    agent any
	environment {
	        DOCKERHUB_CREDENTIALS = credentials('DOCKER_ID_PWD')
	       }

    stages {
	        stage('fetch-latest-code') {
	            steps {
	                git branch: 'main', url: 'https://github.com/iLimbani/DevOps-1.git'
	            }
	        }

		stage('Build docker image') {      
		steps {       
		        sh 'sudo systemctl start docker'
			sh 'sudo usermod -aG docker ec2-user'
			sh 'sudo docker build -t ilimbani/dmain:dimg1 .'
		          }
		      }

	//	stage('push docker image to hub') {      
	//	steps {
	//		script{
	//		         sh 'docker login -u ilimbani -p ${DOCKER_ID_PWD}'
	//		}       
	//			sh 'docker push ilimbani/dmain:dimg1'
	//	          }
	//	}
}
}

