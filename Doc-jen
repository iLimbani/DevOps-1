pipeline {
   	agent any

	environment {
	        DOCKER_ID = credentials('DOCKER_ID')
	        DOCKER_PASSWORD = credentials('DOCKER_PASSWORD')
	}

    stages {
	        stage('fetch-latest-code') {
	            steps {
	                git branch: 'main', url: 'https://github.com/iLimbani/DevOps-1.git'
	            }
	        }

		stage('Build docker image') {      
		steps {       
		        sh 'sudo systemctl start docker'
			sh 'sudo usermod -aG docker ec2-user'
			sh 'sudo docker build -t ilimbani/dmain:dimg1 .'
		          }
		      }

		stage('push docker image to hub') {      
		steps {
			script{
			         sh 'docker login -u ${DOCKER_ID} -p ${DOCKER_PASSWORD}'
			}       
				sh 'docker push ilimbani/dmain:dimg1'
		          }
		}
}
}

