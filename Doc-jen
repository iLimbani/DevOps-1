pipeline {
    agent any
    tools{
        maven 'maven_3_5_0'
    }
    stages{
        stage('Build Maven'){
            steps{
                checkout([$class: 'GitSCM', branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/iLimbani/DevOps-1.git']]])
                sh 'mvn clean install'
            }
        }
      stage('fetch_latest_code') {
        steps {
        git branch: 'main', url: 'https://github.com/iLimbani/DevOps-1.git'
     }
     }           
     
    stage('Build docker image') {
        steps {
    //     withCredentials([string(credentialsId: 'dockerhub-pwd', variable: 'dockerhubpwd')])
          //  sh 'docker login -u ilimbani -p ${dockerhubpwd}'          
            sh 'docker build -t ilimbani/dmain .'
          }
      }

stage('push docker image to hub') {
        steps {
         withCredentials([string(credentialsId: 'dockerhub-pwd', variable: 'dockerhubpwd')])
            sh 'docker login -u ilimbani -p ${dockerhubpwd}'
            sh 'docker push ilimbani/dmain'
          }
}

}
}

